1.网络安全的五大属性
 1)保密性
   保证信息不会泄露给非授权用户
   措施:防侦听，信息加密

 2)完整性
   保证信息不会被非授权用户篡改，以及被授权用户进行不恰当的篡改
   措施:密码校验，数字签名

 3)可用性
   信息和信息系统随时可以为授权者提供服务，而不被非授权者滥用 
   措施:访问控制

 4)不可否认性
   用于不能抵赖自己做出的行为
   措施:数字签名，审计追踪
   
 5)可控性
   能够信息和信息系统进行有效控制和掌握


2.PDRR模型
 1)Protection
 2)Detection
   漏洞检测
 3)Reaction
   对网络攻击做出快速的响应，降低损失
 4)Restore
   尽快恢复受攻击的系统
 4者有机结合

3.常见网络攻击
 1)阻塞类
   强制占有信道资源，网络连接资源，存储空间资源
   使服务器崩溃或者资源耗尽，无法对外提供服务
   比如:DoS(Denial of Service)
        SYN Flood:利用大量伪造IP向服务器发出连接请求
                  服务器的SYN包无法得到响应
                  服务器的网络连接资源被占用，导致其他正常用户不能再连接服务器
                  解决:对每个半开连接进行限时，超时就断开连接
 
 2)控制类
   试图获得目标机器的控制权的攻击
   比如:口令截获与破解  --> 暴力穷举，密码监听，键盘记录
        特洛伊木马      --> 攻击系统得到系统权限，并未下次入侵留下后门
  
 3)探测类
   收集与目标系统的各种与网络安全有关的信息，为下一步入侵做准备
   常用信息收集工具ping,fping,ARP探测
 
 4)欺骗类
   进行身份冒充，欺骗用户
   比如DNS欺骗，IP欺骗
 
 5)漏洞类
   利用 系统本身的漏洞
   比如缓冲区溢出漏洞
 
 6)破坏类
   计算机病毒，逻辑炸弹(没有传染性)

1.C=密文
  M=明文
  K=对称密钥
  E=加密算法
  D=解密算法

  发送方:C=E(M,K)
  接收方:M=D(C,K)

2.对称加密:发送方和接收方采用同一密钥
 对称密码包括:
 1)分组密码:先按一定长度对明文分组，以组为单位进行加密/解密
 2)序列密码:不分组，按位加密

 对称加密:算法简单，速度快，适合加密大量数据

3.对称加密通信过程:
  A,B双方通信前，A先通过 安全信道 把密钥K发给B
  然后A再将明文M进行加密，用 公开信道 将密文传给B.
  B收到密文C后，再进行解密

  简单序列密码:
  加密:C = E(M,K) --> C = M 异或 K
  解密:M = D(C,K) --> M = C 异或 K

  同步序列密码:
  假如明文为m1,m2...
  给定种子密钥k,将其传给 密钥序列产生器 --> 其能不停地产生密钥k1,k2...
  为明文的每一位采用不同的密钥进行加密:Ci = mi 异或 ki
  接收方也采用同样的方式进行解密: Mi = Ci 异或 ki
  在通信过程中，通信双发必须保持精确地同步
  若丢失一个密文字符，那么接收方后续的解密将会一直错误

  优点:
   1)对密文失步很敏感 ---> 容易检测出插入，删除等攻击
   2)没有错误传播 ---> 若某个密文字符出现差错，那么只影响该字符的解密，不影响其他字符


4.分组密码设计原则
  1)混乱原则(confusion)
    明文，密钥，密文三者之间的统计关系尽可能地复杂化
  2)扩散原则(diffusion)
    明文和密钥中任何一位发生变化，都会较大程度上影响密文值的变化

  分组密码常用操作:异或，移位，置乱，替换

5.DES分组加密算法........
  AES加密算法:分组长度和密钥长度可变

6.对称密码体制的问题:
 1)密钥管理
   如何安全的传输密钥?
   每对通信者之间都需要一个共同的密钥
   n个人通信需要n(n-1)/2个  -->   密钥空间太大
 
 2)没有解决不可抵赖问题
   文档不能被签名
   通信双方都可以否认发送或接受过的信息



7.非对称密码
 1)大致思想
   假如A与B通信
   A用B的公钥进行数据加密，然后只有B的私钥才能解密
 
 2)理论基础:单向陷门函数
   单向函数:已知y，计算x使得y=f(x)是难解的
   单向陷门函数:若知道t，计算y=f(x)是容易的
                t就为陷门

   
   公钥密码特点:
   a.基于数学函数而非替代和置换   ---->   解密比对称密码慢
   c.非对称.其使用两个独立的密钥:私钥和公钥
     任何一个可用于加密，另一个用于解密
   b.通常公钥可以被任何人知道，用于加密消息和验证签名
     私钥则用于解密消息和签名
   
8.组合对称密码和非对称密码
  假如A与B通信:A先采用非对称密钥通信，将对称密钥传输给B --> 用B的公钥加密 对称密钥
               然后A与B开启对称密钥通信
  
  问题:B并不知道与其通信的对象就是A
       B需要验证A的身份
  
  解决:采用数字签名
       A用私钥签名一段信息
       B只能用A的公钥解开   --->    B就知道该信息肯定是A发送的

       通常会对一段较短的信息进行签名:信息摘要(Message Digest)
       MD特点:
       a.其为一个函数，接收任意长度的信息，输出一个短固定长度的编码
         常为散列函数:MD5,SHA
       b.每个信息的MD值都是唯一的 --> 源信息篡改肯定会导致MD改变  
       c.可用于加密
  
  结合上述技术的A与B通信:
  1)A先生成一段明文的MD，然后用A的私钥加密，得到A的数字签名
    再用B的公钥对 对称密钥 加密
    将二者一同发给B
  2)B先用A的公钥解密数字签名，以验证信息的确由A发送
    再用自己的密钥解密 对称密钥
  3)此后二者开启对称密钥通信


1.网络通讯的4个安全要素
 1)机密性
   信息是否会泄露给他人
   解决:进行信息加密
 
 2)完整性
   怎样知道信息是否被篡改过
   解决:采用MD    --->    发送者将明文的MD以及加密后的明文一起发送
                          接收者解密出明文后，也生成MD，然后进行MD的匹配
 
 3)鉴别与授权
   是否与身份正确的人通信
   解决:用数字证书进行身份认证
 
 4)不可抵赖
   发出的信息不可抵赖
   解决:采用数字签名


2.A与B通信时，A首先将对称密钥(用B的公钥加密)连同数字签名(用A的私钥加密的摘要)一同发给B
  B先用A的公钥解密数字签名，验证A的身份
  然后用B的私钥解密出对称密钥

  可见通信双方都必须持有对方的公钥
  怎样获得对方的公钥?
  怎样才能知道一个公钥属于谁?
  如果收到一个自称是某人的公钥，能相信吗?

  数字证书:公钥和用户身份的结合
  先由CA来证实用户的身份，再用CA的私钥对 用户身份和公钥相结合的证书 进行签名，以证实CA的有效性
  通常电脑中都有 知名CA机构的公钥

  基于数字证书的A与B通信:
  1)A先将自己的证书发给B
  2)B要进行证书验证:
    a.用证书颁发者的公钥进行解密
    b.用证书中指定的 hash算法 对整个证书进行hash运算,得到MD
      将原有的MD与新生成的MD进行比较，看证书是否被篡改过
    c.查看证书中的用户身份是否就是A
    d.取出证书中的公钥

  3)二次身份认证:B向A随机发送一个字符串
                 A收到后用私钥进行加密，然后将密文发送给B
                 B用A的公钥解开密文，若密文中的字符串与之前的随机字符串一致，则能确认A的身份
  
  4)B将 对称加密算法和对称密钥 用A的公钥加密，再发送给A
    只有A的私钥能进行解密
  
3.PKI(Public Key Infrastructure)
  提供信息加密，数字签名，数字证书等等技术来保护网络通信安全
  其由以下部分组成:
  1)CA(Certification Authorities)
    可信任的机构
    功能:
    签发数字证书
    证书管理:颁发，废除，更新
    CA密钥的管理
    提供证书和证书状态查询

  2)RA(Registration Authorities)
    受理证书申请和管理请求
    对证书申请者的身份进行审核并提交CA制证
    提供证书生命周期的维护工作
  3)CH(Certificate Holders)
    个人，企业...

  4)RP(Replying Parites)
    提供良好的应用接口，在此基础上提供多种安全应用服务
    比如:安全电子邮件，网上信用卡交易，web服务器和浏览器之间的安全通信

  5)Repositories
    证书库

  证书在有效期内可能因为以下原因而而需要废除:
  1)证书用户身份信息的变更
  2)CA 签名私钥的 泄露
  3)证书遭到破坏
  废除的证书被加入到 证书撤销列表(CRL)中
  CA周期性发布CRL,由用户本地存储
  被撤销的证书会一直保存在CRL中，直到过期

               
1.端到端的数据传输
 主机A  ----->  ISP  ----->  Internet  ----->  目标网关   ----->  目标网络中的主机B
        拨入段              公共网络段          网关点  内部网络段                        
 在这四处都有可能发生数据安全问题:
 1)拨入段
   用户数据以明文形式传输到ISP
   攻击者可以在拨入链路上监听
   ISP可以检查用户数据
 
 2)公共网络段
   数据在公共网络端会经过多个路由器的转发
   明文传输的数据很容易在路由器上被查看和修改
 
 3)网关点
   数据在网关中是明文，所以网络管理员可以直接查看机密数据
   网关本身可能会受到攻击，一旦被攻破，流经安全网关的数据将面临风险
 
 4)内部网络段
   内部网中可能存在不信任的主机，路由器
   内部员工可能监听，篡改，重定向企业内部网的数据报文
 
 采用VPN可解决在 公用网络上 数据传输的安全性问题  --->  也可以采用专线保证数据传输的安全性,但费用昂贵

2.VPN(Virtural Private Network)
  VPN是在公共网络中建立的安全网络连接
     其采用专有的协议，来实现数据加密,完整性检验以及用户的身份认证
  Virtual:用户不需要使用网络专线，直接使用Internet公共网络的数据线路
  Private:用户可以根据自己需求自定义安全的私有连接网络
  
  功能:
  1)数据的机密性保护
    在传输过程中对数据进行加密
  2)数据的完整性保护
    检验信息是否被篡改
    方法:发送端对源数据包进行Hash运算，得到信息摘要
         接收端收到数据包后，也对其进行Hash运算生成摘要.然后进行摘要比对

  3)数据源的身份认证
    可检验接收到的数据是否由指定用户发送而来,以防止网络中的伪装攻击事件
    方法:发送端用私钥对摘要进行加密 ---> 形成数字签名
         接收端只能用发送端的公钥才能进行解密 
    

3.VPN的分类
  1)LAN-LAN
    在不同的局域网之间建立安全的数据传输通道
    对终端用户透明

  2)CLIENT-LAN
    提供一种 远程个体安全地访问某内部网络的 手段


3.VPN的四项关键技术
  1)安全隧道技术
    将协议X封装在协议Y中传输，从而实现协议X对共用传输网络的透明性
    隧道协议包括三种:
     a.Passenger Protocol 
       用于加密数据帧 --> 比如PPP协议
     b.Encapuslating Protocol 
       用于封装数据链路层协议 --> PPTP
     c.Carrier Protocol 

    根据隧道协议 作用于OSI模型的层次 进行分类:
     a.二层隧道协议:封装在数据链路层协议中
       1.PPTP(Point to Point Tuneling Protocol)
         由微软公司开发
         数据链路层协议常采用PPP.其适用于点对点的数据传输
         基于PPP实现VPN的方式:主机通过专线连接到RAS Server.
                              但RAS Server可能与主机相距太远 --> 专线成本过高
                              主机如何通过Internet与RAS Server安全地传输数据?

         解决:在主机端增加代理AC(Access Concentrator)
              主机将含有PPP Frame发送给AC.
              Frame结构:PPP Header | 加密的数据(IP Packet)|

              AC将其封装在另一IP Packet内，然后将封装后的IP包发送给RAS
              AC发给RAS的Frame结构:
              PPP Header(记录AC的相关信息) | IP Packet(记录AC的相关信息) | GRE(用于安全验证) | Origin PPP Frame |
              接收方收到数据帧后，逐层拆封
              在IP层拆封后，根据协议，调用相关程序进行GRE的安全验证.
              通过后再从Origin PPP Frame中取出Origin IP Packet

       2.L2TP
         Layer 2 Tuneling Protocol
         PPTP和L2TP的比较:二者都是用PPP协议对IP Packet封装，然后在添加额外Header用于数据的安全传输
                          其他见ppt

     b.三层隧道协议
       IP协议的设计是为了实现网络的互联互通，并没有考虑太多安全问题
       IPSec(Security):由IETF设计的确保端到端IP层通信安全的机制
       其是一个协议集，包括常见的AH,DES-CBC,ES等等协议
       其有两种工作模式:传输模式(不保护IP Header)和隧道模式(保护IP Header)

       IPSec中的协议介绍:
       1.AH(Authentication Header) --> 重在验证 --> 数字摘要
         其提供三种服务:
         1)数据完整性验证
           通过Hash函数生成的摘要来验证
         2)数据源身份验证
         3)防重放攻击
           在AH Header中含有序列号字段
         具体见pdf66

         AH会对整个IP包生成摘要
         若稍后IP包会经过NAT网关,修改了IP包的源地址
         那么接收方收到IP包后生成的摘要会与源摘要不一致 --> 完整性验证失败
       
       2.ESP(Encapsulating Security Payload)协议  --> 验证+加密
         不仅提供认证服务，还提供加密服务

         AH和ESP的联合使用 考虑:
       
       3.IKE协议(Internet Key Exchange)
         IPSec提供多种 数据认证和加密 的协议,认证和加密的算法也有多种,而且数据认证和加密的顺序也可自定义
         所以采用IPSec系统的两台计算机在通信前应该先协商好 数据认证和加密采用的协议,算法以及二者之间的顺序等等

         SA(Security Association)
         双方协商的产物
         其为单向的逻辑连接.在一次通信中，IPSec需要建立两个SA:一个用于入站通信,另一个用于出站通信

         SA包括索引和内容两部分:
         协商好的具体内容(比如Security Protocol,加密算法以及密钥...)存储在SAD(Securit Assocaition Database)中
         SAD就相当于一张表,主键为SPI

         索引也相当于一张表,属性有:
          1)SPI(Security Parameter Index)
            外键 -- 外连接SAD表
          2)Security Protocol
            采用的安全协议(AH,ESP)
          3)Destination Address
            
         SPD(Security Policy Database):类似路由器的防火墙
        
         网络A的主机a 向 网络B中的主机b 发送数据包的过程:
         1)主机a将数据包发给 网络A的VPN网关
         2)VPN网关会去查询SPD,找到该数据包需要使用的安全策略:丢弃,(不)使用IPSec
           查找关键词:源IP,目标IP
         3)若要使用IPSec,则先去SA索引表中查找是否有对应的SA
           查找关键词:目标IP,Security Protocol
           若不存在，则启动IKE协议新建一个SA，并存储到SAD中
           然后根据SA中的指示，对数据包进行安全处理

         4)网络B的VPN网关收到IPSec封装的数据包后，可以从中取出三元组:SPI,DST,Protocol
           然后去查表做相应的安全验证

         SA可由人工手动协商创建，也可以通过IKE协议创建
         SA中最需要保密的内容是 加密算法需要的密钥
         IKE的精髓在于 其没有用 密钥传输的方式 让通信双方共享密钥   --->  因为网络永远不安全
                       而是采用 密钥生成的方式 直接在通信双方处创建密钥
                       核心技术为:Diffie-Hellman密钥交换算法
                                  核心思想为单向函数

         IKE协议也是一组协议.
         ISAKMP(Internet Security Association Key Management Protocol)
         定义了 协商，建立，修改，删除SA的方式

         IKE创建SA有两个阶段:
         1)协商创建一个通信信道(IKE SA),并对信道进行认证
           为双方进一步的IKE通信提供机密性，数据完整性
         2)使用已建立的IKE SA建立IPSec SA --> 用于最终的IP数据的安全传输

         ISAKMP(Internet Security Assocaition Key Management Protocol)

  2)用户认证技术
  3)加解密技术
  4)密钥管理技术

4.NAT
  在局域网内部，为主机分配私有IP地址
  当主机访问外网时,路由网关利用NAT算法可将私有IP转为合法的公有IP
  可缓解公有IP紧缺的问题
  分类:
  1)静态NAT
    内部私有IP和公有IP一一对应

  2)动态NAT
    多个公有IP地址形成地址池
    内部主机访问外网时，NAT就从地址池中为其分配一个公有IP，主机用完后再归还到地址池中

  3)PAT
    使用端口多路复用技术，将多个内部私有IP映射到同一个公有IP
    通过端口号区分各个内部私有IP --> 每个私有IP对应一个网络连接，一台主机可通过多个网络接口建立网络连接

  4)PAT+地址池


防火墙:
 1)能做什么:
   a.实现安全策略
     限制控制策略 -- 白名单
     宽松控制策略 -- 黑名单
   
   b.创建阻塞点 
     所有的流量都要经过该检查点 --> 可以在该检查点进行监视，过滤和检查
   
   c.监视并记录网络活动
   
   d.限制网络暴露
     NAT,代理服务程序

  绕过防火墙的访问，内部攻击，感染了病毒的文件

  防火墙的分类

  关键技术:
  1)包过滤
    会检测数据包的header(IP Port)，看是否满足配置的ACL
    静态包过滤
    动态包过滤 --> 状态检测技术  --> 传输层，状态表
                   比如，内部网先发起网络连接
                         数据包到达防火墙时，状态检测引擎会检测到数据包中的SYN标志
                         于是在状态表中新建一项
                         后续的数据包通过防火墙时，能够在状态表中查到

  2)应用代理
    可以对数据包内容进行检测


  防火墙体系结构
  1)分组过滤防火墙
    内外网络通过分组过滤路由器进行通信 --> 在IP层进行过滤

  2)双宿主机~~
    内外网络之间夹杂双宿主机,不能直接通信

  3)屏蔽主机防火墙
    堡垒主机位于内部网络
    所有的外部流量会被分组过滤路由器引入到堡垒主机中
    堡垒主机安全性高，运行代理服务器程序

  4)屏蔽子网
    堡垒主机没有位于内部网络中，自成周边网络
    外部网络 - 周边网络 - 内部网络
               (代理)
    


入侵检测
 IDS(Intrusion Detection System)
 P2DR模型,Pt,Dt,Rt
 术语:攻击，事件，误报和漏报(体现入侵检测系统的关键参数)，蜜罐，网卡的混杂接收模式
      CIDF:协同多个IDS的规范

 按照分析方法分类:
    误用检测:建立入侵行为特征库
             把外部访问行为与特征库进行匹配

    异常检测:建立正常行为的特征
             计算外部访问行为与正常行为特征的偏离,若偏离过多,则定义为入侵行为

  其他分类:见pdf

  Host IDS:监测主机
   根据检测对象的不同，又分为网络连接检测和主机文件检测

  Network IDS:检测网络段

  入侵检测系统结构



